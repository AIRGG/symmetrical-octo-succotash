import{Q as e,b as l}from"./QItemLabel.ed81b066.js";import{a as o}from"./QSelect.00c3c8b7.js";import{j as a,ca as i,r as s,x as t,w as d,aA as n,a1 as r,b2 as c,d as u,J as f,cJ as b,a4 as m,aa as v,cb as k,c4 as g,ap as w}from"./index.1921beeb.js";import{Q as p}from"./QBadge.2b2d9dcd.js";import{Q as y,a as L}from"./QTd.14f40a51.js";import{Q as h}from"./QPage.a28e4bed.js";import{c as C}from"./index.229e2d0a.js";import{u as x,t as _,Q as j,c as O}from"./module-master.be57f47e.js";import{u as V}from"./myglobalstate.9e951e82.js";import"./QList.0ff0e2c9.js";const A={class:"row q-col-gutter-xs"},Q={class:"col-6"},q={class:"col-6"},B={class:"row q-mb-md q-col-gutter-xs"},J={class:"col-6"},N={class:"col-6"},S={class:"row q-mb-md justify-between"},D={class:"q-gutter-xs"},z={class:"q-gutter-xs"},U={class:"row"},W={class:"col-12"},I={class:"row self-center content-center justify-center q-gutter-xs"},P=a({__name:"MasterBlokPage",setup(a){const P=i(),R=x();V().title="Master Blok",JSON.parse(JSON.stringify(_));const F=s(C(R.officeList)),M=s(C(R.warehouseList)),$=s([{name:"offid",label:"Office",field:"offdesc",align:"left",sortable:!0},{name:"wareid",label:"Warehouse",field:"waredesc",align:"left",sortable:!0},{name:"blokid",label:"Blok Code",field:"blokid",align:"left",sortable:!0},{name:"blokdesc",label:"Desc",field:"blokdesc",align:"left",sortable:!0},{name:"action",label:"Action",field:"",required:!0,align:"center"}]),E=s(),T=t({isedit:!1,action:"Add",disable:!1,index:-1,blok:C(O),oldid:JSON.stringify(C(O))}),Y=s(),G=async()=>{var e;Y.value.reset(),T.isedit=!1,T.disable=!1,T.action="Add",T.blok=C(O),T.oldid=null!=(e=JSON.stringify(C(O)))?e:"",R.getBlokAll(),F.value=C(R.officeList),M.value=C(R.warehouseList)},H=async(e,l)=>{var o;console.log(e),le=!0,T.disable=!0,T.isedit=!0,T.action="Detail",T.oldid=null!=(o=JSON.stringify(e))?o:"",T.blok=C(e),await w(),le=!1},K=async()=>{if(await Y.value.validate()){console.log("ok"),console.log(T,"here");try{await R.saveBlok(T),G()}catch(e){}}},X=async(e,l)=>{if(F.value&&F.value.length>0)return""===e?void l((()=>{F.value=R.officeList})):void l((()=>{const l=e.toLowerCase();F.value=R.officeList.filter((e=>e.offdesc&&e.offdesc.toLowerCase().indexOf(l)>-1))}));await R.getOfficeAll(),l((()=>{F.value=R.officeList}))},Z=async(e,l)=>{if(M.value&&M.value.length>0)return""===e?T.blok.offid&&T.blok.offid.length>0?void l((()=>{var e;const l=null==(e=T.blok.offid)?void 0:e.toLowerCase();M.value=R.warehouseList.filter((e=>e.offid&&e.offid.toLowerCase().indexOf(null!=l?l:"")>-1))})):void l((()=>{M.value=R.warehouseList})):void l((()=>{const l=e.toLowerCase();M.value=R.warehouseList.filter((e=>e.waredesc&&e.waredesc.toLowerCase().indexOf(l)>-1))}));await R.getWarehouseAll(),l((()=>{M.value=R.warehouseList}))},ee=[e=>e&&e.length>0||"Required!"];let le=!1;return d((()=>T.blok.wareid),((e,l)=>{var o;let a=M.value.findIndex((l=>`${l.offid}${l.wareid}`==e));-1!=a&&(T.blok.offid=null!=(o=M.value[a].offid)?o:"",le=!0)})),d((()=>T.blok.offid),((e,l)=>{le?le=!1:T.blok.wareid=""})),Promise.all([R.getOfficeAll(),R.getWarehouseAll(),R.getBlokAll()]).then((e=>{F.value=C(R.officeList),M.value=C(R.warehouseList)})),(a,i)=>(n(),r(h,{padding:""},{default:c((()=>[u(f(b),{greedy:"",ref_key:"formRef",ref:Y},{default:c((()=>[m("div",A,[m("div",Q,[u(o,{filled:"",modelValue:f(T).blok.offid,"onUpdate:modelValue":i[0]||(i[0]=e=>f(T).blok.offid=e),"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Office",options:F.value,rules:ee,onFilter:X,"option-value":"offcode","option-label":"offdesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":c((()=>[u(e,null,{default:c((()=>[u(l,{class:"text-grey"},{default:c((()=>[v(" No results ")])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),m("div",q,[u(o,{filled:"",modelValue:f(T).blok.wareid,"onUpdate:modelValue":i[1]||(i[1]=e=>f(T).blok.wareid=e),"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Warehouse",options:M.value,rules:ee,onFilter:Z,"option-value":"wareunqid","option-label":"waredesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":c((()=>[u(e,null,{default:c((()=>[u(l,{class:"text-grey"},{default:c((()=>[v(" No results ")])),_:1})])),_:1})])),_:1},8,["modelValue","options"])])]),m("div",B,[m("div",J,[u(k,{dense:"",filled:"","lazy-rules":"",rules:ee,label:"Blok Code",modelValue:f(T).blok.blokid,"onUpdate:modelValue":i[2]||(i[2]=e=>f(T).blok.blokid=e)},null,8,["modelValue"])]),m("div",N,[u(k,{dense:"",filled:"","lazy-rules":"",rules:ee,label:"Description",modelValue:f(T).blok.blokdesc,"onUpdate:modelValue":i[3]||(i[3]=e=>f(T).blok.blokdesc=e)},null,8,["modelValue"])])])])),_:1},512),m("div",S,[m("div",D,[u(p,{outline:"",color:"primary",label:f(T).action},null,8,["label"])]),m("div",z,[u(g,{color:"warning",label:"Cancel",onClick:G}),u(g,{color:"primary",label:"Save",disable:f(T).disable,onClick:K},null,8,["disable"])])]),m("div",U,[m("div",W,[u(f(j),{loading:f(P).loadingBar.isActive,columns:$.value,rows:f(R).blokList,ref_key:"tblRef",ref:E},{"body-cell-action":c((({row:e,rowIndex:l})=>[u(y,null,{default:c((()=>[m("div",I,[u(g,{dense:"",round:"",color:"primary",icon:"info",onClick:o=>H(e,l)},null,8,["onClick"]),u(g,{dense:"",round:"",color:"warning",icon:"edit",onClick:o=>(async(e,l)=>{console.log(e),await H(e),T.index=l,T.isedit=!0,T.disable=!1,T.action="Edit"})(e,l)},null,8,["onClick"]),u(g,{dense:"",round:"",color:"negative",icon:"delete",onClick:l=>(async(e,l)=>{console.log(e),await H(e),T.action="Delete",P.dialog({title:"Confirm",message:"Yakin Delete?",cancel:!0,persistent:!0}).onOk((async()=>{await R.saveBlok(T)})).onCancel((()=>{})).onDismiss((()=>{G()}))})(e)},null,8,["onClick"])])])),_:2},1024)])),loading:c((()=>[u(L,{showing:"",color:"primary"})])),_:1},8,["loading","columns","rows"])])])])),_:1}))}});export{P as default};
