import{j as a,ca as e,c1 as l,x as s,r as o,o as t,aI as r,aA as i,a1 as n,b2 as d,a4 as c,d as b,J as f,c4 as g,aa as p,a3 as m,F as u,aG as v,P as w,a2 as k,b4 as y,bo as h,cJ as x,cb as j,b as _,cW as I,cN as B,ap as N}from"./index.1921beeb.js";import{Q,a as D}from"./QTd.14f40a51.js";import{Q as T}from"./QPage.a28e4bed.js";import{u as P,Q as q,a as S,d as C}from"./module-master.be57f47e.js";import{Q as F}from"./QTr.f317700d.js";import{u as G,f as L,t as R}from"./module-transaksi.a96af80c.js";import{u as U}from"./myglobalstate.9e951e82.js";import{c as V}from"./index.229e2d0a.js";import{_ as A}from"./ComQDialogBig.ace7afb0.js";import"./index.cd11fcc9.js";import{t as $}from"./upload-file.01a69925.js";import{_ as z}from"./ComImagePdf.5f9f2127.js";import"./QList.0ff0e2c9.js";import"./QSelect.00c3c8b7.js";import"./QItemLabel.ed81b066.js";import"./_commonjsHelpers.6150b38b.js";import"./QImg.65c43243.js";const H={class:"row justify-content-between"},J={class:"col"},K={class:"col text-right"},W={class:"row q-mt-md"},O={class:"col-12"},E={key:0},M={key:2},X={class:"row"},Y={class:"col-12"},Z={class:"row q-mt-sm"},aa={class:"col-12"},ea={class:"row"},la={class:"col-12"},sa={class:"row"},oa={class:"col-12"},ta=a({__name:"TransaksiBarangNonaktifPage",setup(a){const ta=e();U().title="Nonaktif Barang";const ra=G(),ia=l(),na=[a=>a&&a.length>0||"Required!"],da=[a=>a&&a.size>0||"Required!"],ca=s({...V(L)}),ba=o();o([{name:"trxid",label:"TrxID",field:"trxid",align:"left",sortable:!0},{name:"typetrx",label:"TrxID",field:"typetrx",align:"left",sortable:!0},{name:"action",label:"Action",field:"",required:!0,align:"center"}]);const fa=async()=>{const a=await ra.getTransaksiNonaktif(),e=[];a.data.data.masterstok.map((async(a,l)=>{let s=V(a);e.push(I.get("/assets?url="+s.imgbarang).then((async e=>{let l={...$};console.log(e);const s=await B(e.data.data.base64);l.bloburl=s.url,l.blob=s.blob,l.base64=e.data.data.base64,a.imgbarang=l}))),e.push(I.get("/assets?url="+s.pdfbarang).then((async e=>{let l={...$};const s=await B(e.data.data.base64);l.bloburl=s.url,l.blob=s.blob,l.base64=e.data.data.base64,a.pdfbarang=l})))})),await Promise.allSettled(e),ca.detail=V(a.data.data.masterstok),ra.dbBarangDetail=ca.detail};t((()=>{fa()}));const ga=o([]),pa=o([{name:"uploadfile",label:"Uploaded File",field:"uploadfile",required:!1,align:"center",sortable:!1},{name:"barid",label:"BarID",field:"barid",align:"left",sortable:!0},{name:"trxid",label:"TrxID",field:"crtrxid",align:"left",sortable:!0},{name:"offdesc",label:"Office",field:"offdesc",align:"left",sortable:!0},{name:"waredesc",label:"Warehouse",field:"waredesc",align:"left",sortable:!0},{name:"blokdesc",label:"Blok",field:"blokdesc",align:"left",sortable:!0},{name:"locdesc",label:"Location",field:"locdesc",align:"left",sortable:!0},{name:"notes",label:"Note",field:"notes",align:"left",sortable:!0},{name:"desc",label:"Desc",field:"desc",align:"left",sortable:!0},{name:"descgroup1",label:"Group1",field:"descgroup1",align:"left",sortable:!0},{name:"descgroup2",label:"Group2",field:"descgroup2",align:"left",sortable:!0},{name:"descgroup3",label:"Group3",field:"descgroup3",align:"left",sortable:!0},{name:"ibaid",label:"Iba ID",field:"ibaid",align:"left",sortable:!0},{name:"kdcif",label:"CIF",field:"kdcif",align:"left",sortable:!0},{name:"namacif",label:"CIF Name",field:"namacif",align:"left",sortable:!0}]),ma=o([]),ua=o(!1),va=()=>0===ma.value.length?"":`${ma.value.length} record${ma.value.length>1?"s":""} selected of ${ga.value.length}`,wa=async()=>{ia.getKey,ya.location=V(C),ma.value=[],ua.value=!0,(async()=>{const a=await ra.getTransaksiBeforeNonaktif(),e=[];a.data.data.detail.map((async(a,l)=>{let s=V(a);e.push(I.get("/assets?url="+s.imgbarang).then((async e=>{let l={...$};console.log(e);const s=await B(e.data.data.base64);l.bloburl=s.url,l.blob=s.blob,l.base64=e.data.data.base64,a.imgbarang=l}))),e.push(I.get("/assets?url="+s.pdfbarang).then((async e=>{let l={...$};const s=await B(e.data.data.base64);l.bloburl=s.url,l.blob=s.blob,l.base64=e.data.data.base64,a.pdfbarang=l})))})),await Promise.allSettled(e),ya.detail=V(a.data.data.detail),ga.value=ya.detail,ra.dbBarangDetail=ca.detail})()},ka=async()=>{ua.value=!1,ya.barangstok=V(R)},ya=s({...V(ca),barangstok:V(R),listbarangstok:[],isedit:!1,oldid:null,index:-1}),ha=o(),xa=async()=>{if(!(await ha.value.validate()))return;if(0==ma.value.length)return void ta.notify({type:"negative",message:"Silahkan pilih salah satu..!",position:"center",progress:!0});console.log(ya.barangstok);let a={header:V(ya.barangstok),detail:V(ma.value)};try{await ra.saveTransaksiNonaktif(a)}catch(e){return void console.log(e)}ta.notify({type:"positive",message:"Success Save..!",position:"center",progress:!0}),fa(),await N(),ka()},ja=P();return o(V(ja.officeList)),o(V(ja.warehouseList)),(a,e)=>{const l=r("com-q-file");return i(),n(f(T),{padding:""},{default:d((()=>[c("div",H,[c("div",J,[b(f(g),{color:"primary",onClick:wa,icon:"post_add","no-caps":""},{default:d((()=>[p("Form Barang Nonaktif")])),_:1})]),c("div",K,[b(f(g),{color:"primary",icon:"refresh","no-caps":"",onClick:fa})])]),c("div",W,[c("div",O,[b(f(q),{dense:"",loading:f(ta).loadingBar.isActive,columns:pa.value,rows:f(ra).dbBarangDetail,ref_key:"tblRef",ref:ba},{header:d((a=>[b(f(F),{props:a},{default:d((()=>[(i(!0),m(u,null,v(a.cols,(e=>(i(),n(f(S),{key:e.name,props:a},{default:d((()=>[p(w(e.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:d((a=>[b(f(F),{props:a},{default:d((()=>[(i(!0),m(u,null,v(a.cols,(e=>(i(),n(f(Q),{key:e.name,props:a},{default:d((()=>["action"==e.name?(i(),m("div",E)):k("",!0),"uploadfile"==e.name?(i(),n(z,{key:1,row:a.row,rowIndex:a.rowIndex,isshow:""},null,8,["row","rowIndex"])):(i(),m("div",M,w(e.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),y(b(f(F),{props:a},{default:d((()=>[b(f(Q),{colspan:"100%"})])),_:2},1032,["props"]),[[h,a.expand]])])),loading:d((()=>[b(f(D),{showing:"",color:"primary"})])),_:1},8,["loading","columns","rows"])])]),b(A,{"custom-fn-save":xa,"label-save":"Save",onHide:ka,"show-dialog":ua.value},{title:d((()=>[p(" Form Nonaktif Barang ")])),default:d((()=>[b(f(x),{greedy:"",ref_key:"formPopupRef",ref:ha},{default:d((()=>{var a,s,o,t;return[c("div",X,[c("div",Y,[b(j,{modelValue:ya.barangstok.notes,"onUpdate:modelValue":e[0]||(e[0]=a=>ya.barangstok.notes=a),filled:"","lazy-rules":"",rules:na,label:"Notes",dense:"",placeholder:"Keterangan Nonaktif.."},null,8,["modelValue"])])]),c("div",Z,[c("div",aa,[b(f(q),{loading:f(ta).loadingBar.isActive,rows:f(ga),columns:pa.value,"rows-per-page-options":[0],ref_key:"tblRef",ref:ba,"row-key":"barid","selected-rows-label":va,selection:"multiple",selected:f(ma),"onUpdate:selected":e[1]||(e[1]=a=>_(ma)?ma.value=a:null)},{"body-cell-uploadfile":d((a=>[b(f(Q),{props:a},{default:d((()=>[b(z,{row:a.row,rowIndex:a.rowIndex,isshow:""},null,8,["row","rowIndex"])])),_:2},1032,["props"])])),loading:d((()=>[b(f(D),{showing:"",color:"primary"})])),_:1},8,["loading","rows","columns","selected"])])]),c("div",ea,[c("div",la,[b(l,{b64:null!=(s=null==(a=ya.barangstok.imgbarang)?void 0:a.base64)?s:void 0,"onUpdate:modelValue":e[2]||(e[2]=a=>ya.barangstok.imgbarang=a),rules:da,label:"Pilih Gambar",accept:"image/png, image/jpeg, image/jpg","is-image":""},null,8,["b64"])])]),c("div",sa,[c("div",oa,[b(l,{b64:null!=(t=null==(o=ya.barangstok.pdfbarang)?void 0:o.base64)?t:void 0,"onUpdate:modelValue":e[3]||(e[3]=a=>ya.barangstok.pdfbarang=a),accept:"application/pdf"},null,8,["b64"])])])]})),_:1},512)])),_:1},8,["show-dialog"])])),_:1})}}});export{ta as default};
