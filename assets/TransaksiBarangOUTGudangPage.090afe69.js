import{j as a,ca as e,c1 as l,x as s,r as o,o as t,aI as n,aA as r,a1 as i,b2 as d,a4 as c,d as b,J as g,c4 as u,aa as p,a3 as m,F as f,aG as w,P as v,a2 as y,b4 as k,bo as h,cJ as x,b as j,cW as I,cN as _,ap as B}from"./index.1921beeb.js";import{Q as D,a as C}from"./QTd.14f40a51.js";import{Q as G}from"./QPage.a28e4bed.js";import{u as T,Q as O,a as Q,d as P}from"./module-master.be57f47e.js";import{Q as U}from"./QTr.f317700d.js";import{u as q,f as S,t as R}from"./module-transaksi.a96af80c.js";import{u as F}from"./myglobalstate.9e951e82.js";import{_ as L}from"./ComExpandRow.bb27df81.js";import{c as A}from"./index.229e2d0a.js";import{_ as E}from"./ComQDialogBig.ace7afb0.js";import"./index.cd11fcc9.js";import{t as H}from"./upload-file.01a69925.js";import{_ as $}from"./ComImagePdf.5f9f2127.js";import"./QList.0ff0e2c9.js";import"./QSelect.00c3c8b7.js";import"./QItemLabel.ed81b066.js";import"./QImg.65c43243.js";import"./ComBarcodeGenerator.1bbbf28b.js";import"./_commonjsHelpers.6150b38b.js";const z={class:"row justify-content-between"},J={class:"col"},K={class:"col text-right"},N={class:"row q-mt-md"},V={class:"col-12"},W={key:0},Y={key:1},M={class:"row q-mt-sm"},X={class:"col-12"},Z={class:"row"},aa={class:"col-12"},ea={class:"row"},la={class:"col-12"},sa=a({__name:"TransaksiBarangOUTGudangPage",setup(a){const sa=e();F().title="Request Barang Keluar Gudang";const oa=q(),ta=l(),na=[a=>a&&a.size>0||"Required!"],ra=s({...A(S)}),ia=o(),da=o([{name:"trxid",label:"TrxID",field:"trxid",align:"left",sortable:!0},{name:"typetrx",label:"TrxID",field:"typetrx",align:"left",sortable:!0},{name:"action",label:"Action",field:"",required:!0,align:"center"}]),ca=async()=>{const a=await oa.getTransaksiOUT(),e=[];a.data.data.detail.map((async(a,l)=>{let s=A(a);e.push(I.get("/assets?url="+s.imgbarang).then((async e=>{let l={...H};console.log(e);const s=await _(e.data.data.base64);l.bloburl=s.url,l.blob=s.blob,l.base64=e.data.data.base64,a.imgbarang=l}))),e.push(I.get("/assets?url="+s.pdfbarang).then((async e=>{let l={...H};const s=await _(e.data.data.base64);l.bloburl=s.url,l.blob=s.blob,l.base64=e.data.data.base64,a.pdfbarang=l})))})),await Promise.allSettled(e);let l=[];a.data.data.header.map((e=>{let s=a.data.data.detail.filter((a=>a.reftrxid==e.trxid));l.push(s)})),oa.dbBarangInOutGudangDetail=A(a.data.data.detail),oa.dbBarangDetailExpand=A(l),oa.dbBarangInOutGudangHeader=A(a.data.data.header),console.log(oa.dbBarangInOutGudangDetail.length),console.log(oa.dbBarangDetailExpand.length)};t((()=>{ca()}));const ba=o([]),ga=o([{name:"uploadfile",label:"Uploaded File",field:"uploadfile",required:!1,align:"center",sortable:!1},{name:"barid",label:"BarID",field:"barid",align:"left",sortable:!0},{name:"trxid",label:"TrxID",field:"crtrxid",align:"left",sortable:!0},{name:"offdesc",label:"Office",field:"offdesc",align:"left",sortable:!0},{name:"waredesc",label:"Warehouse",field:"waredesc",align:"left",sortable:!0},{name:"blokdesc",label:"Blok",field:"blokdesc",align:"left",sortable:!0},{name:"locdesc",label:"Location",field:"locdesc",align:"left",sortable:!0},{name:"desc",label:"Desc",field:"desc",align:"left",sortable:!0},{name:"descgroup1",label:"Group1",field:"descgroup1",align:"left",sortable:!0},{name:"descgroup2",label:"Group2",field:"descgroup2",align:"left",sortable:!0},{name:"descgroup3",label:"Group3",field:"descgroup3",align:"left",sortable:!0},{name:"ibaid",label:"Iba ID",field:"ibaid",align:"left",sortable:!0},{name:"kdcif",label:"CIF",field:"kdcif",align:"left",sortable:!0},{name:"namacif",label:"CIF Name",field:"namacif",align:"left",sortable:!0}]),ua=o([]),pa=o(!1),ma=()=>0===ua.value.length?"":`${ua.value.length} record${ua.value.length>1?"s":""} selected of ${ba.value.length}`,fa=async()=>{ta.getKey,va.location=A(P),ua.value=[],pa.value=!0,(async()=>{const a=await oa.getBarangGudangMove(),e=[];a.data.data.masterstok.map((async(a,l)=>{let s=A(a);e.push(I.get("/assets?url="+s.imgbarang).then((async e=>{let l={...H};console.log(e);const s=await _(e.data.data.base64);l.bloburl=s.url,l.blob=s.blob,l.base64=e.data.data.base64,a.imgbarang=l}))),e.push(I.get("/assets?url="+s.pdfbarang).then((async e=>{let l={...H};const s=await _(e.data.data.base64);l.bloburl=s.url,l.blob=s.blob,l.base64=e.data.data.base64,a.pdfbarang=l})))})),await Promise.allSettled(e),va.detail=A(a.data.data.masterstok),ba.value=va.detail,oa.dbBarangDetail=ra.detail})()},wa=async()=>{pa.value=!1,va.barangstok=A(R)},va=s({...A(ra),barangstok:A(R),listbarangstok:[],isedit:!1,oldid:null,index:-1}),ya=o(),ka=async()=>{await ya.value.validate()&&(0!=ua.value.length?(console.log(va.barangstok),sa.dialog({title:"Confirm",message:"Yakin?, Pastikan semua sudah benar...",cancel:!0,persistent:!0}).onOk((async()=>{let a={header:A(va.location),detail:A(ua.value)};try{await oa.saveTransaksiOUT(a)}catch(e){return void console.log(e)}sa.notify({type:"positive",message:"Success Save..!",position:"center",progress:!0}),ca(),await B(),wa()})).onCancel((()=>{})).onDismiss((()=>{}))):sa.notify({type:"negative",message:"Silahkan pilih salah satu..!",position:"center",progress:!0}))},ha=T();return o(A(ha.officeList)),o(A(ha.warehouseList)),(a,e)=>{const l=n("com-q-file");return r(),i(g(G),{padding:""},{default:d((()=>[c("div",z,[c("div",J,[b(g(u),{color:"primary",onClick:fa,icon:"post_add","no-caps":""},{default:d((()=>[p("Form Barang OUT Gudang")])),_:1})]),c("div",K,[b(g(u),{color:"primary",icon:"refresh","no-caps":"",onClick:ca})])]),c("div",N,[c("div",V,[b(g(O),{dense:"",loading:g(sa).loadingBar.isActive,columns:da.value,rows:g(oa).dbBarangInOutGudangHeader,ref_key:"tblRef",ref:ia,"row-key":"trxid"},{header:d((a=>[b(g(U),{props:a},{default:d((()=>[b(g(Q),{"auto-width":""}),(r(!0),m(f,null,w(a.cols,(e=>(r(),i(g(Q),{key:e.name,props:a},{default:d((()=>[p(v(e.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:d((a=>[b(g(U),{props:a},{default:d((()=>[b(g(D),{"auto-width":""},{default:d((()=>[b(g(u),{size:"sm",color:"accent",round:"",dense:"",onClick:e=>a.expand=!a.expand,icon:a.expand?"remove":"add"},null,8,["onClick","icon"])])),_:2},1024),(r(!0),m(f,null,w(a.cols,(e=>(r(),i(g(D),{key:e.name,props:a},{default:d((()=>["action"==e.name?(r(),m("div",W,[["1",1].includes(a.row.paid)?(r(),i(g(u),{key:0,dense:"",round:"",color:"negative",icon:"delete",onClick:e=>(async(a,e)=>{sa.dialog({title:"Confirm",message:"Yakin Delete?",cancel:!0,persistent:!0}).onOk((async()=>{let e={header:a,detail:[]};try{await oa.deleteTransaksiOutGudang(e)}catch(l){return void console.log(l)}sa.notify({caption:"Success Delete",position:"center",type:"positive",progress:!0,group:!1}),ca()})).onCancel((()=>{})).onDismiss((()=>{}))})(a.row,a.rowIndex)},null,8,["onClick"])):y("",!0)])):(r(),m("div",Y,v(e.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),k(b(g(U),{props:a},{default:d((()=>[b(g(D),{colspan:"100%"},{default:d((()=>[b(L,{rowIndex:a.rowIndex,tblrow:g(oa).dbBarangDetailExpand[a.rowIndex]},null,8,["rowIndex","tblrow"])])),_:2},1024)])),_:2},1032,["props"]),[[h,a.expand]])])),loading:d((()=>[b(g(C),{showing:"",color:"primary"})])),_:1},8,["loading","columns","rows"])])]),b(E,{"custom-fn-save":ka,"label-save":"Save",onHide:wa,"show-dialog":pa.value},{title:d((()=>[p(" Form Request OUT Gudang ")])),default:d((()=>[b(g(x),{greedy:"",ref_key:"formPopupRef",ref:ya},{default:d((()=>{var a,s,o,t;return[c("div",M,[c("div",X,[b(g(O),{loading:g(sa).loadingBar.isActive,rows:g(ba),columns:ga.value,"rows-per-page-options":[0],ref_key:"tblRef",ref:ia,"row-key":"barid","selected-rows-label":ma,selection:"multiple",selected:g(ua),"onUpdate:selected":e[0]||(e[0]=a=>j(ua)?ua.value=a:null)},{"body-cell-uploadfile":d((a=>[b(g(D),{props:a},{default:d((()=>[b($,{row:a.row,rowIndex:a.rowIndex,isshow:""},null,8,["row","rowIndex"])])),_:2},1032,["props"])])),loading:d((()=>[b(g(C),{showing:"",color:"primary"})])),_:1},8,["loading","rows","columns","selected"])])]),c("div",Z,[c("div",aa,[b(l,{b64:null!=(s=null==(a=va.barangstok.imgbarang)?void 0:a.base64)?s:void 0,"onUpdate:modelValue":e[1]||(e[1]=a=>va.barangstok.imgbarang=a),rules:na,label:"Pilih Gambar",accept:"image/png, image/jpeg, image/jpg","is-image":""},null,8,["b64"])])]),c("div",ea,[c("div",la,[b(l,{b64:null!=(t=null==(o=va.barangstok.pdfbarang)?void 0:o.base64)?t:void 0,"onUpdate:modelValue":e[2]||(e[2]=a=>va.barangstok.pdfbarang=a),accept:"application/pdf"},null,8,["b64"])])])]})),_:1},512)])),_:1},8,["show-dialog"])])),_:1})}}});export{sa as default};
