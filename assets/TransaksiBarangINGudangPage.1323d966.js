import{j as a,ca as e,c1 as l,x as o,r as s,o as t,aI as i,aA as n,a1 as r,b2 as d,a4 as c,d as u,J as f,c4 as p,aa as b,a3 as g,F as m,aG as v,P as w,a2 as h,b4 as y,bo as k,cJ as x,b as _,cW as I,cN as j,ap as C}from"./index.1921beeb.js";import{Q as L,a as D}from"./QTd.14f40a51.js";import{Q as B,b as G}from"./QItemLabel.ed81b066.js";import{Q}from"./QPage.a28e4bed.js";import{a as O}from"./QSelect.00c3c8b7.js";import{u as T,Q as q,a as P,d as A}from"./module-master.be57f47e.js";import{Q as F}from"./QTr.f317700d.js";import{u as N,f as S,t as V}from"./module-transaksi.a96af80c.js";import{u as R}from"./myglobalstate.9e951e82.js";import{_ as U}from"./ComExpandRow.bb27df81.js";import{c as E}from"./index.229e2d0a.js";import{_ as z}from"./ComQDialogBig.ace7afb0.js";import"./index.cd11fcc9.js";import{t as H}from"./upload-file.01a69925.js";import{_ as W}from"./ComImagePdf.5f9f2127.js";import"./QList.0ff0e2c9.js";import"./QImg.65c43243.js";import"./ComBarcodeGenerator.1bbbf28b.js";import"./_commonjsHelpers.6150b38b.js";const $={class:"row justify-content-between"},J={class:"col"},Y={class:"col text-right"},K={class:"row q-mt-md"},M={class:"col-12"},X={key:0},Z={key:1},aa={class:"row"},ea={class:"col-12"},la={class:"row"},oa={class:"col-12"},sa={class:"row q-mt-sm"},ta={class:"col-12"},ia={class:"row"},na={class:"col-12"},ra={class:"row"},da={class:"col-12"},ca=a({__name:"TransaksiBarangINGudangPage",setup(a){const ca=e();R().title="Request Barang Masuk Gudang";const ua=N(),fa=l(),pa=[a=>a&&a.length>0||"Required!"],ba=[a=>a&&a.size>0||"Required!"],ga=o({...E(S)}),ma=s(),va=s([{name:"trxid",label:"TrxID",field:"trxid",align:"left",sortable:!0},{name:"typetrx",label:"TrxID",field:"typetrx",align:"left",sortable:!0},{name:"action",label:"Action",field:"",required:!0,align:"center"}]),wa=async()=>{const a=await ua.getTransaksiIN(),e=[];a.data.data.detail.map((async(a,l)=>{let o=E(a);e.push(I.get("/assets?url="+o.imgbarang).then((async e=>{let l={...H};console.log(e);const o=await j(e.data.data.base64);l.bloburl=o.url,l.blob=o.blob,l.base64=e.data.data.base64,a.imgbarang=l}))),e.push(I.get("/assets?url="+o.pdfbarang).then((async e=>{let l={...H};const o=await j(e.data.data.base64);l.bloburl=o.url,l.blob=o.blob,l.base64=e.data.data.base64,a.pdfbarang=l})))})),await Promise.allSettled(e);let l=[];a.data.data.header.map((e=>{let o=a.data.data.detail.filter((a=>a.reftrxid==e.trxid));l.push(o)})),ua.dbBarangInOutGudangDetail=E(a.data.data.detail),ua.dbBarangDetailExpand=E(l),ua.dbBarangInOutGudangHeader=E(a.data.data.header),console.log(ua.dbBarangInOutGudangDetail.length),console.log(ua.dbBarangDetailExpand.length)};t((()=>{wa()}));const ha=s([]),ya=s([{name:"uploadfile",label:"Uploaded File",field:"uploadfile",required:!1,align:"center",sortable:!1},{name:"barid",label:"BarID",field:"barid",align:"left",sortable:!0},{name:"trxid",label:"TrxID",field:"crtrxid",align:"left",sortable:!0},{name:"desc",label:"Desc",field:"desc",align:"left",sortable:!0},{name:"descgroup1",label:"Group1",field:"descgroup1",align:"left",sortable:!0},{name:"descgroup2",label:"Group2",field:"descgroup2",align:"left",sortable:!0},{name:"descgroup3",label:"Group3",field:"descgroup3",align:"left",sortable:!0},{name:"ibaid",label:"Iba ID",field:"ibaid",align:"left",sortable:!0},{name:"kdcif",label:"CIF",field:"kdcif",align:"left",sortable:!0},{name:"namacif",label:"CIF Name",field:"namacif",align:"left",sortable:!0}]),ka=s([]),xa=s(!1),_a=()=>0===ka.value.length?"":`${ka.value.length} record${ka.value.length>1?"s":""} selected of ${ha.value.length}`,Ia=async()=>{const a=fa.getKey;Ca.location=E(A),ka.value=[],xa.value=!0,await Ba.getOfficeAll(),Ga.value=Ba.officeList,Ca.location.offid=a.offcode,await Ba.getWarehouseAll(),Qa.value=Ba.warehouseList,(async()=>{const a=await ua.getTransaksiCreate(),e=[];a.data.data.masterstok.map((async(a,l)=>{let o=E(a);e.push(I.get("/assets?url="+o.imgbarang).then((async e=>{let l={...H};console.log(e);const o=await j(e.data.data.base64);l.bloburl=o.url,l.blob=o.blob,l.base64=e.data.data.base64,a.imgbarang=l}))),e.push(I.get("/assets?url="+o.pdfbarang).then((async e=>{let l={...H};const o=await j(e.data.data.base64);l.bloburl=o.url,l.blob=o.blob,l.base64=e.data.data.base64,a.pdfbarang=l})))})),await Promise.allSettled(e),Ca.detail=E(a.data.data.masterstok),Ca.header=E(a.data.data.header[0]),ha.value=Ca.detail})()},ja=async()=>{xa.value=!1,Ca.barangstok=E(V)},Ca=o({...E(ga),barangstok:E(V),listbarangstok:[],isedit:!1,oldid:null,index:-1}),La=s(),Da=async()=>{await La.value.validate()&&(0!=ka.value.length?(console.log(Ca.barangstok),ca.dialog({title:"Confirm",message:"Yakin?, Pastikan semua sudah benar...",cancel:!0,persistent:!0}).onOk((async()=>{let a={header:E(Ca.location),detail:E(ka.value)};try{await ua.saveTransaksiIN(a)}catch(e){return void console.log(e)}ca.notify({type:"positive",message:"Success Save..!",position:"center",progress:!0}),wa(),await C(),ja()})).onCancel((()=>{})).onDismiss((()=>{}))):ca.notify({type:"negative",message:"Silahkan pilih salah satu..!",position:"center",progress:!0}))},Ba=T(),Ga=s(E(Ba.officeList)),Qa=s(E(Ba.warehouseList)),Oa=async(a,e)=>{if(Ga.value&&Ga.value.length>0)return""===a?void e((()=>{Ga.value=Ba.officeList})):void e((()=>{const e=a.toLowerCase();Ga.value=Ba.officeList.filter((a=>a.offdesc&&a.offdesc.toLowerCase().indexOf(e)>-1))}));await Ba.getOfficeAll(),e((()=>{Ga.value=Ba.officeList}))},Ta=async(a,e)=>{if(Qa.value&&Qa.value.length>0)return""===a?Ca.location.offid&&Ca.location.offid.length>0?void e((()=>{var a;const e=null==(a=Ca.location.offid)?void 0:a.toLowerCase();Qa.value=Ba.warehouseList.filter((a=>a.offid&&a.offid.toLowerCase().indexOf(null!=e?e:"")>-1))})):void e((()=>{Qa.value=Ba.warehouseList})):void e((()=>{const e=a.toLowerCase();Qa.value=Ba.warehouseList.filter((a=>a.waredesc&&a.waredesc.toLowerCase().indexOf(e)>-1))}));await Ba.getWarehouseAll(),e((()=>{Qa.value=Ba.warehouseList}))};return(a,e)=>{const l=i("com-q-file");return n(),r(f(Q),{padding:""},{default:d((()=>[c("div",$,[c("div",J,[u(f(p),{color:"primary",onClick:Ia,icon:"post_add","no-caps":""},{default:d((()=>[b("Form Barang IN Gudang")])),_:1})]),c("div",Y,[u(f(p),{color:"primary",icon:"refresh","no-caps":"",onClick:wa})])]),c("div",K,[c("div",M,[u(f(q),{dense:"",loading:f(ca).loadingBar.isActive,columns:va.value,rows:f(ua).dbBarangInOutGudangHeader,ref_key:"tblRef",ref:ma,"row-key":"trxid"},{header:d((a=>[u(f(F),{props:a},{default:d((()=>[u(f(P),{"auto-width":""}),(n(!0),g(m,null,v(a.cols,(e=>(n(),r(f(P),{key:e.name,props:a},{default:d((()=>[b(w(e.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:d((a=>[u(f(F),{props:a},{default:d((()=>[u(f(L),{"auto-width":""},{default:d((()=>[u(f(p),{size:"sm",color:"accent",round:"",dense:"",onClick:e=>a.expand=!a.expand,icon:a.expand?"remove":"add"},null,8,["onClick","icon"])])),_:2},1024),(n(!0),g(m,null,v(a.cols,(e=>(n(),r(f(L),{key:e.name,props:a},{default:d((()=>["action"==e.name?(n(),g("div",X,[["1",1].includes(a.row.paid)?(n(),r(f(p),{key:0,dense:"",round:"",color:"negative",icon:"delete",onClick:e=>(async(a,e)=>{ca.dialog({title:"Confirm",message:"Yakin Delete?",cancel:!0,persistent:!0}).onOk((async()=>{let e={header:a,detail:[]};try{await ua.deleteTransaksiInGudang(e)}catch(l){return void console.log(l)}ca.notify({caption:"Success Delete",position:"center",type:"positive",progress:!0,group:!1}),wa()})).onCancel((()=>{})).onDismiss((()=>{}))})(a.row,a.rowIndex)},null,8,["onClick"])):h("",!0)])):(n(),g("div",Z,w(e.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),y(u(f(F),{props:a},{default:d((()=>[u(f(L),{colspan:"100%"},{default:d((()=>[u(U,{rowIndex:a.rowIndex,tblrow:f(ua).dbBarangDetailExpand[a.rowIndex]},null,8,["rowIndex","tblrow"])])),_:2},1024)])),_:2},1032,["props"]),[[k,a.expand]])])),loading:d((()=>[u(f(D),{showing:"",color:"primary"})])),_:1},8,["loading","columns","rows"])])]),u(z,{"custom-fn-save":Da,"label-save":"Save",onHide:ja,"show-dialog":xa.value},{title:d((()=>[b(" Form Edit ")])),default:d((()=>[u(f(x),{greedy:"",ref_key:"formPopupRef",ref:La},{default:d((()=>{var a,o,s,t;return[c("div",aa,[c("div",ea,[u(f(O),{filled:"",modelValue:Ca.location.offid,"onUpdate:modelValue":e[0]||(e[0]=a=>Ca.location.offid=a),"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Office",options:Ga.value,rules:pa,onFilter:Oa,"option-value":"offcode","option-label":"offdesc","emit-value":"","map-options":"",behavior:"menu",disable:""},{"no-option":d((()=>[u(f(B),null,{default:d((()=>[u(f(G),{class:"text-grey"},{default:d((()=>[b(" No results ")])),_:1})])),_:1})])),_:1},8,["modelValue","options"])])]),c("div",la,[c("div",oa,[u(f(O),{filled:"",modelValue:Ca.location.wareid,"onUpdate:modelValue":e[1]||(e[1]=a=>Ca.location.wareid=a),"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Warehouse",options:Qa.value,rules:pa,onFilter:Ta,"option-value":"wareunqid","option-label":"waredesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":d((()=>[u(f(B),null,{default:d((()=>[u(f(G),{class:"text-grey"},{default:d((()=>[b(" No results ")])),_:1})])),_:1})])),_:1},8,["modelValue","options"])])]),c("div",sa,[c("div",ta,[u(f(q),{loading:f(ca).loadingBar.isActive,rows:f(ha),columns:ya.value,"rows-per-page-options":[0],ref_key:"tblRef",ref:ma,"row-key":"barid","selected-rows-label":_a,selection:"multiple",selected:f(ka),"onUpdate:selected":e[2]||(e[2]=a=>_(ka)?ka.value=a:null)},{"body-cell-uploadfile":d((a=>[u(f(L),{props:a},{default:d((()=>[u(W,{row:a.row,rowIndex:a.rowIndex,isshow:""},null,8,["row","rowIndex"])])),_:2},1032,["props"])])),loading:d((()=>[u(f(D),{showing:"",color:"primary"})])),_:1},8,["loading","rows","columns","selected"])])]),c("div",ia,[c("div",na,[u(l,{b64:null!=(o=null==(a=Ca.barangstok.imgbarang)?void 0:a.base64)?o:void 0,"onUpdate:modelValue":e[3]||(e[3]=a=>Ca.barangstok.imgbarang=a),rules:ba,label:"Pilih Gambar",accept:"image/png, image/jpeg, image/jpg","is-image":""},null,8,["b64"])])]),c("div",ra,[c("div",da,[u(l,{b64:null!=(t=null==(s=Ca.barangstok.pdfbarang)?void 0:s.base64)?t:void 0,"onUpdate:modelValue":e[4]||(e[4]=a=>Ca.barangstok.pdfbarang=a),accept:"application/pdf"},null,8,["b64"])])])]})),_:1},512)])),_:1},8,["show-dialog"])])),_:1})}}});export{ca as default};
