import{j as e,r as a,ca as t,ar as s,db as l,x as o,aA as i,a3 as r,d as n,b2 as d,J as u,cJ as c,a4 as p,cb as m,c4 as f,aa as h,F as b,ap as g}from"./index.1921beeb.js";import{Q as v,a as y}from"./QTd.14f40a51.js";import{Q as k}from"./QPage.a28e4bed.js";import{Q as w}from"./module-master.be57f47e.js";import{Q as x,_ as C}from"./ComQDialogBig.ace7afb0.js";import{_ as V}from"./ComQFile.b7eee83f.js";import{c as j}from"./index.229e2d0a.js";import{u as T,t as P,f as _}from"./module-transaksi.a96af80c.js";import{u as S}from"./myglobalstate.9e951e82.js";import{_ as Q}from"./ComImagePdf.5f9f2127.js";import"./QList.0ff0e2c9.js";import"./QSelect.00c3c8b7.js";import"./QItemLabel.ed81b066.js";import"./QBadge.2b2d9dcd.js";import"./QImg.65c43243.js";import"./upload-file.01a69925.js";function R(e,a,t,s,l){var o;try{o=t.resolve(e())}catch(i){o=t.reject(i)}return o.then(a,a),s&&o.then(s,l),o}var U=function(){function e(e,a,t){this.func=e,this.Promise=a,this.stamp=t}return e.prototype.delay=function(){var e=this;return this.promise||(this.promise=new this.Promise((function(a,t){e.resolve=a,e.reject=t}))),this.promise},e.prototype.resume=function(e){return R(this.func,e,this.Promise,this.resolve,this.reject)},e}(),B=function(){function e(e,a){var t=void 0===a?{}:a,s=t.getPos,l=t.setPos;this.compare=e,this.heap=[],this.last=0,this.getPos=s,this.setPos=l||function(e,a){}}return e.prototype.clear=function(){this.heap=[],this.last=0},e.prototype.isEmpty=function(){return!this.last},e.prototype.insert=function(e){return this.bubble(e,this.last++)},e.prototype.update=function(e){var a=this.getPos;if(!a)throw new Error("Cannot get index of item in the heap");var t=a(e),s=t-1>>>1,l=this.compare(this.heap[s],e);return l>0?this.bubble(e,t):l<0&&this.sink(e,t),e},e.prototype.peekTop=function(){return this.last?this.heap[0]:null},e.prototype.extractTop=function(){if(!this.last)return null;var e=this.heap[0],a=this.heap[--this.last];return this.heap[this.last]=void 0,this.sink(a,0),e},e.prototype.bubble=function(e,a){for(var t,s,l=this.heap,o=this.compare,i=this.setPos;a>0&&!(o(s=l[t=a-1>>>1],e)<=0);)l[a]=s,i(s,a),a=t;l[a]=e,i(e,a)},e.prototype.sink=function(e,a){for(var t,s,l,o,i,r=this.heap,n=this.last,d=this.compare,u=this.setPos;;){if(t=2*a+1,(s=2*a+2)<n)if(d(o=r[t],i=r[s])<0){if(!(d(o,e)<0))break;l=t}else{if(!(d(i,e)<0))break;l=s}else{if(!(t<n&&d(r[t],e)<0))break;l=t}r[a]=r[l],u(r[a],a),a=l}r[a]=e,u(e,a)},e}(),q=function(){function e(e,a){var t=this;this.Promise=e,this.concurrency=a,this.busyCount=0,this.backlog=new B((function(e,a){return e.stamp-a.stamp})),this.Promise=e,this.concurrency=a,this.nextBound=function(){return t.next(1)},this.nextTickBound=function(){t.timerStamp=0,t.next(0)}}return e.prototype.add=function(e,a){if(void 0===a&&(a=0),this.busyCount<this.concurrency&&!a)return++this.busyCount,R(e,this.nextBound,this.Promise);var t=(new Date).getTime()+a,s=new U(e,this.Promise,t);return this.backlog.insert(s),s.delay()},e.prototype.unblock=function(e){var a=this;this.next(1);var t=function(){return++a.busyCount};return e.then(t,t),e},e.prototype.wrap=function(e,a){var t=this;return function(){for(var s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];return t.add((function(){return e.apply(a,s)}))}},e.prototype.next=function(e){var a=(new Date).getTime(),t=null;this.busyCount-=e,this.busyCount<this.concurrency&&(t=this.backlog.peekTop()),t&&(t.stamp<=a?(++this.busyCount,(t=this.backlog.extractTop()).resume(this.nextBound)):(!this.timerStamp||t.stamp+1<this.timerStamp)&&(this.timerStamp&&clearTimeout(this.timer),this.timer=setTimeout(this.nextTickBound,~~(t.stamp-a+1)),this.timerStamp=t.stamp))},e}();const I={class:"row q-mb-md q-col-gutter-xs"},z={class:"col-3"},A={class:"col-3"},F={class:"col-3"},D={class:"col-3"},G={class:"row q-mb-sm"},E={class:"col-12 text-right"},H={class:"row"},J={class:"col-12"},K={class:"row q-mt-md justify-between"},L={class:"q-gutter-xs"},M={class:"q-gutter-xs"},N={class:"row"},O={class:"col-12"},W={class:"row"},X={class:"col-12"},Y={class:"row"},Z={class:"col-12"},$={class:"row"},ee={class:"col-12"},ae={class:"row"},te={class:"col-12"},se={class:"row"},le={class:"col-12"},oe=e({__name:"TransaksiBarangFormPage",setup(e){S().title="Form Barang (CREATE)";const R=T(),U=[e=>e&&e.length>0||"Required!"],B=[e=>e&&e.size>0||"Required!"];a("");const oe=t(),ie=a(),re=a([{name:"remove",label:"",field:"",align:"left",sortable:!1},{name:"desc",label:"Description",field:"desc",align:"left",sortable:!0},{name:"desc1",label:"Group 1",field:"descgroup1",align:"left",sortable:!0},{name:"desc2",label:"Group 2",field:"descgroup2",align:"left",sortable:!0},{name:"desc3",label:"Group 3",field:"descgroup3",align:"left",sortable:!0},{name:"uploadfile",label:"Uploaded File",field:"uploadfile",required:!1,align:"center",sortable:!1}]),ne=a(j(P));a(j(ne.value));const de=a([]);j(_);const ue=async()=>{ie.value.reset(),de.value=[],ne.value=j(P)},ce=async()=>{if(!(await ie.value.validate()))return;if(0==de.value.length)return void oe.notify({type:"negative",message:"Silahkan Add Row dahulu..!",position:"center"});console.log("ok");let e={header:ne.value,detail:[]},a=await R.saveTransaksiCreate(e,"header");console.log(a);const t=a.data.data.trxid;ne.value.crtrxid=t,ne.value.reftrxid=t,e.header=ne.value;try{const a=new q(Promise,1);await Promise.allSettled(de.value.map(a.wrap((async(a,t)=>(e.detail=[a],e.header.crtrxnorut=t+1,console.log(e.detail,"detailsini"),await R.saveTransaksiCreate(e,"detail"))))));e.detail=[];await R.saveTransaksiCreate(e,"move");oe.notify({type:"positive",message:"Success Save..!",position:"center",progress:!0}),R.router.push({name:"dashboard.transaksi.barang"})}catch(s){return console.log(s),void oe.notify({type:"negative",message:"Uppsss.!",position:"center"})}};s((async()=>{if(R.formTransaksi.isedit){if(!R.formTransaksi.header)return;if(!R.formTransaksi.detail)return;ne.value=R.formTransaksi.header,de.value=R.formTransaksi.detail}else R.formTransaksi={...j(_)}})),l((()=>{R.formTransaksi={...j(_)}}));const pe=a(!1),me=async()=>{pe.value=!1,fe.barangstok=j(P)},fe=o({barangstok:j(P),isedit:!1,oldid:null,index:-1}),he=a(),be=async()=>{await he.value.validate()&&(fe.isedit||de.value.push(j(fe.barangstok)),fe.isedit&&(de.value[fe.index]=j(fe.barangstok),fe.index=-1,fe.isedit=!1),await g(),me(),fe.barangstok=j(P))};return(e,a)=>(i(),r(b,null,[n(u(k),{padding:""},{default:d((()=>[n(u(c),{greedy:"",ref_key:"formRef",ref:ie},{default:d((()=>[p("div",I,[p("div",z,[n(u(m),{dense:"",filled:"","lazy-rules":"",rules:U,label:"CIF",modelValue:u(ne).kdcif,"onUpdate:modelValue":a[0]||(a[0]=e=>u(ne).kdcif=e)},null,8,["modelValue"])]),p("div",A,[n(u(m),{dense:"",filled:"","lazy-rules":"",rules:U,label:"Nama CIF",modelValue:u(ne).namacif,"onUpdate:modelValue":a[1]||(a[1]=e=>u(ne).namacif=e)},null,8,["modelValue"])]),p("div",F,[n(u(m),{dense:"",filled:"","lazy-rules":"",rules:U,label:"IBA Code",modelValue:u(ne).ibaid,"onUpdate:modelValue":a[2]||(a[2]=e=>u(ne).ibaid=e)},null,8,["modelValue"])]),p("div",D,[n(u(m),{dense:"",filled:"","lazy-rules":"",rules:U,label:"Desc",modelValue:u(ne).desc,"onUpdate:modelValue":a[3]||(a[3]=e=>u(ne).desc=e)},null,8,["modelValue"])])]),p("div",G,[p("div",E,[n(u(f),{color:"primary",label:"Add Row","no-caps":"",icon:"add",dense:"",onClick:a[4]||(a[4]=e=>pe.value=!0)})])]),p("div",H,[p("div",J,[n(u(w),{loading:u(oe).loadingBar.isActive,rows:de.value,columns:re.value,"rows-per-page-options":[0],ref:"tblRef"},{"body-cell-remove":d((({row:e,rowIndex:a})=>[n(u(v),{class:"q-gutter-xs"},{default:d((()=>[n(u(f),{dense:"",round:"",color:"negative",icon:"clear",onClick:e=>(async(e,a)=>{de.value.splice(a,1)})(0,a)},{default:d((()=>[n(u(x),null,{default:d((()=>[h("Remove")])),_:1})])),_:2},1032,["onClick"]),n(u(f),{dense:"",round:"",color:"warning",icon:"edit",onClick:t=>(async(e,a)=>{fe.barangstok=j(e),fe.index=a,fe.isedit=!0,pe.value=!0})(e,a)},{default:d((()=>[n(u(x),null,{default:d((()=>[h("Edit")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),"body-cell-uploadfile":d((({row:e,rowIndex:a})=>[n(u(v),{class:"q-gutter-xs"},{default:d((()=>[n(Q,{row:e,rowIndex:a},null,8,["row","rowIndex"])])),_:2},1024)])),loading:d((()=>[n(u(y),{showing:"",color:"primary"})])),_:1},8,["loading","rows","columns"])])])])),_:1},512),p("div",K,[p("div",L,[n(u(f),{label:"Kembali",to:{name:"dashboard.transaksi.barang"}},null,8,["to"])]),p("div",M,[n(u(f),{color:"warning",label:"Cancel",onClick:ue}),n(u(f),{color:"primary",label:"Save",onClick:ce})])])])),_:1}),n(C,{"custom-fn-save":be,"label-save":fe.isedit?"Update Row":"Add Row","full-width":!1,"full-height":!1,onHide:me,"show-dialog":pe.value,"custom-style":"width: 600px"},{title:d((()=>[h(" Form Add Row ")])),default:d((()=>[n(u(c),{greedy:"",ref_key:"formPopupRef",ref:he},{default:d((()=>{var e,t,s,l;return[p("div",N,[p("div",O,[n(u(m),{modelValue:fe.barangstok.desc,"onUpdate:modelValue":a[5]||(a[5]=e=>fe.barangstok.desc=e),filled:"","lazy-rules":"",rules:U,label:"Desc",dense:"",placeholder:"Deskripsi Barang.."},null,8,["modelValue"])])]),p("div",W,[p("div",X,[n(u(m),{modelValue:fe.barangstok.descgroup1,"onUpdate:modelValue":a[6]||(a[6]=e=>fe.barangstok.descgroup1=e),filled:"","lazy-rules":"",rules:[e=>e.length>-1||"a"],label:"Group 1",dense:"",placeholder:"ex: Surat, Kendaraan"},null,8,["modelValue","rules"])])]),p("div",Y,[p("div",Z,[n(u(m),{modelValue:fe.barangstok.descgroup2,"onUpdate:modelValue":a[7]||(a[7]=e=>fe.barangstok.descgroup2=e),filled:"","lazy-rules":"",rules:[e=>e.length>-1||"a"],label:"Group 2",dense:"",placeholder:"ex: Sertifikat, Motor"},null,8,["modelValue","rules"])])]),p("div",$,[p("div",ee,[n(u(m),{modelValue:fe.barangstok.descgroup3,"onUpdate:modelValue":a[8]||(a[8]=e=>fe.barangstok.descgroup3=e),filled:"","lazy-rules":"",rules:[e=>e.length>-1||"a"],label:"Group 3",dense:"",placeholder:"ex: Sertifikat Rumah, Motor Honda"},null,8,["modelValue","rules"])])]),p("div",ae,[p("div",te,[n(V,{b64:null!=(t=null==(e=fe.barangstok.imgbarang)?void 0:e.base64)?t:void 0,"onUpdate:modelValue":a[9]||(a[9]=e=>fe.barangstok.imgbarang=e),rules:B,label:"Pilih Gambar",accept:"image/png, image/jpeg, image/jpg","is-image":""},null,8,["b64"])])]),p("div",se,[p("div",le,[n(V,{b64:null!=(l=null==(s=fe.barangstok.pdfbarang)?void 0:s.base64)?l:void 0,"onUpdate:modelValue":a[10]||(a[10]=e=>fe.barangstok.pdfbarang=e),accept:"application/pdf"},null,8,["b64"])])])]})),_:1},512)])),_:1},8,["label-save","show-dialog"])],64))}});export{oe as default};
