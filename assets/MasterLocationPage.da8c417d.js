import{Q as e,b as l}from"./QItemLabel.ed81b066.js";import{a as o}from"./QSelect.00c3c8b7.js";import{j as a,ca as i,r as t,x as s,w as n,aA as d,a1 as c,b2 as r,d as u,J as f,cJ as v,a4 as b,aa as m,cb as w,c4 as g,ap as p}from"./index.1921beeb.js";import{Q as L}from"./QBadge.2b2d9dcd.js";import{Q as k,a as y}from"./QTd.14f40a51.js";import{Q as h}from"./QPage.a28e4bed.js";import{c as C}from"./index.229e2d0a.js";import{u as x,t as _,Q as O,d as V}from"./module-master.be57f47e.js";import{u as j}from"./myglobalstate.9e951e82.js";import"./QList.0ff0e2c9.js";const q={class:"row q-col-gutter-xs"},A={class:"col-4"},Q={class:"col-4"},N={class:"col-4"},J={class:"row q-mb-md q-col-gutter-xs"},S={class:"col-6"},B={class:"col-6"},D={class:"row q-mb-md justify-between"},z={class:"q-gutter-xs"},U={class:"q-gutter-xs"},I={class:"row"},W={class:"col-12"},F={class:"row self-center content-center justify-center q-gutter-xs"},P=a({__name:"MasterLocationPage",setup(a){const P=i(),R=x();j().title="Master Location",JSON.parse(JSON.stringify(_));const M=t(C(R.officeList)),E=t(C(R.warehouseList)),T=t(C(R.blokList)),Y=t([{name:"offid",label:"Office",field:"offdesc",align:"left",sortable:!0},{name:"wareid",label:"Warehouse",field:"waredesc",align:"left",sortable:!0},{name:"blokid",label:"Blok",field:"blokdesc",align:"left",sortable:!0},{name:"locid",label:"Location Code",field:"locid",align:"left",sortable:!0},{name:"locdesc",label:"Desc",field:"locdesc",align:"left",sortable:!0},{name:"action",label:"Action",field:"",required:!0,align:"center"}]),G=t(),H=s({isedit:!1,action:"Add",disable:!1,index:-1,location:C(V),oldid:JSON.stringify(C(V))}),K=t(),X=async()=>{var e;K.value.reset(),H.isedit=!1,H.disable=!1,H.action="Add",H.location=C(V),H.oldid=null!=(e=JSON.stringify(C(V)))?e:"",R.getLocationAll(),M.value=C(R.officeList),E.value=C(R.warehouseList),T.value=C(R.blokList)},Z=async(e,l)=>{var o;console.log(e),se=!0,H.disable=!0,H.isedit=!0,H.action="Detail",H.oldid=null!=(o=JSON.stringify(e))?o:"",H.location=C(e),await p(),se=!1,ie=!1},$=async()=>{if(await K.value.validate()){console.log("ok"),console.log(H,"here");try{await R.saveLocation(H),X()}catch(e){}}},ee=async(e,l)=>{if(M.value&&M.value.length>0)return""===e?void l((()=>{M.value=R.officeList})):void l((()=>{const l=e.toLowerCase();M.value=R.officeList.filter((e=>e.offdesc&&e.offdesc.toLowerCase().indexOf(l)>-1))}));await R.getOfficeAll(),l((()=>{M.value=R.officeList}))},le=async(e,l)=>{if(E.value&&E.value.length>0)return""===e?H.location.offid&&H.location.offid.length>0?void l((()=>{var e;const l=null==(e=H.location.offid)?void 0:e.toLowerCase();E.value=R.warehouseList.filter((e=>e.offid&&e.offid.toLowerCase().indexOf(null!=l?l:"")>-1))})):void l((()=>{E.value=R.warehouseList})):void l((()=>{const l=e.toLowerCase();E.value=R.warehouseList.filter((e=>e.waredesc&&e.waredesc.toLowerCase().indexOf(l)>-1))}));await R.getWarehouseAll(),l((()=>{E.value=R.warehouseList}))},oe=async(e,l)=>{if(T.value&&T.value.length>0)return""===e?H.location.wareid&&H.location.wareid.length>0?void l((()=>{var e;const l=null==(e=H.location.wareid)?void 0:e.toLowerCase();T.value=R.blokList.filter((e=>e.wareid&&e.wareid.toLowerCase().indexOf(null!=l?l:"")>-1))})):void l((()=>{T.value=R.blokList})):void l((()=>{const l=e.toLowerCase();T.value=R.blokList.filter((e=>e.blokdesc&&e.blokdesc.toLowerCase().indexOf(l)>-1))}));await R.getBlokAll(),l((()=>{T.value=R.blokList}))},ae=[e=>e&&e.length>0||"Required!"];let ie=!1,te=!1,se=!1;return n((()=>H.location.wareid),((e,l)=>{var o;if(te||se)return void(te=!1);let a=E.value.findIndex((l=>l.wareunqid==e));-1!=a&&(H.location.offid=null!=(o=E.value[a].offid)?o:"",ie=!0,H.location.blokid="")})),n((()=>H.location.blokid),((e,l)=>{var o,a;if(ie||se)return void(ie=!1);let i=T.value.findIndex((l=>l.blokunqid==e));-1!=i&&(H.location.offid=null!=(o=T.value[i].offid)?o:"",H.location.wareid=null!=(a=T.value[i].wareid)?a:"",te=!0,ie=!0)})),n((()=>H.location.offid),((e,l)=>{if(console.log(se,ie,te,"picu"),ie||te||se)return ie=!1,void(te=!1);H.location.wareid="",H.location.blokid=""})),Promise.all([R.getOfficeAll(),R.getWarehouseAll(),R.getBlokAll(),R.getLocationAll()]).then((e=>{M.value=R.officeList,E.value=R.warehouseList,T.value=R.blokList})),(a,i)=>(d(),c(h,{padding:""},{default:r((()=>[u(f(v),{greedy:"",ref_key:"formRef",ref:K},{default:r((()=>[b("div",q,[b("div",A,[u(o,{filled:"",modelValue:f(H).location.offid,"onUpdate:modelValue":i[0]||(i[0]=e=>f(H).location.offid=e),"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Office",options:M.value,rules:ae,onFilter:ee,"option-value":"offcode","option-label":"offdesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":r((()=>[u(e,null,{default:r((()=>[u(l,{class:"text-grey"},{default:r((()=>[m(" No results ")])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),b("div",Q,[u(o,{filled:"",modelValue:f(H).location.wareid,"onUpdate:modelValue":i[1]||(i[1]=e=>f(H).location.wareid=e),"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Warehouse",options:E.value,rules:ae,onFilter:le,"option-value":"wareunqid","option-label":"waredesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":r((()=>[u(e,null,{default:r((()=>[u(l,{class:"text-grey"},{default:r((()=>[m(" No results ")])),_:1})])),_:1})])),_:1},8,["modelValue","options"])]),b("div",N,[u(o,{filled:"",modelValue:f(H).location.blokid,"onUpdate:modelValue":i[2]||(i[2]=e=>f(H).location.blokid=e),"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Blok",options:T.value,rules:ae,onFilter:oe,"option-value":"blokunqid","option-label":"blokdesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":r((()=>[u(e,null,{default:r((()=>[u(l,{class:"text-grey"},{default:r((()=>[m(" No results ")])),_:1})])),_:1})])),_:1},8,["modelValue","options"])])]),b("div",J,[b("div",S,[u(w,{dense:"",filled:"","lazy-rules":"",rules:ae,label:"Location Code",modelValue:f(H).location.locid,"onUpdate:modelValue":i[3]||(i[3]=e=>f(H).location.locid=e)},null,8,["modelValue"])]),b("div",B,[u(w,{dense:"",filled:"","lazy-rules":"",rules:ae,label:"Description",modelValue:f(H).location.locdesc,"onUpdate:modelValue":i[4]||(i[4]=e=>f(H).location.locdesc=e)},null,8,["modelValue"])])])])),_:1},512),b("div",D,[b("div",z,[u(L,{outline:"",color:"primary",label:f(H).action},null,8,["label"])]),b("div",U,[u(g,{color:"warning",label:"Cancel",onClick:X}),u(g,{color:"primary",label:"Save",disable:f(H).disable,onClick:$},null,8,["disable"])])]),b("div",I,[b("div",W,[u(f(O),{loading:f(P).loadingBar.isActive,columns:Y.value,rows:f(R).locationList,ref_key:"tblRef",ref:G},{"body-cell-action":r((({row:e,rowIndex:l})=>[u(k,null,{default:r((()=>[b("div",F,[u(g,{dense:"",round:"",color:"primary",icon:"info",onClick:o=>Z(e,l)},null,8,["onClick"]),u(g,{dense:"",round:"",color:"warning",icon:"edit",onClick:o=>(async(e,l)=>{console.log(e),await Z(e),H.index=l,H.isedit=!0,H.disable=!1,H.action="Edit"})(e,l)},null,8,["onClick"]),u(g,{dense:"",round:"",color:"negative",icon:"delete",onClick:l=>(async(e,l)=>{console.log(e),await Z(e),H.action="Delete",P.dialog({title:"Confirm",message:"Yakin Delete?",cancel:!0,persistent:!0}).onOk((async()=>{await R.saveLocation(H)})).onCancel((()=>{})).onDismiss((()=>{X()}))})(e)},null,8,["onClick"])])])),_:2},1024)])),loading:r((()=>[u(y,{showing:"",color:"primary"})])),_:1},8,["loading","columns","rows"])])])])),_:1}))}});export{P as default};
