import{Q as e,a as l}from"./QTd.14f40a51.js";import{c as a}from"./index.229e2d0a.js";import{j as o,r as i,ca as t,c as s,w as d,ar as n,o as u,aA as r,a1 as f,b2 as c,d as b,J as v,cJ as m,a4 as p,aa as g,a3 as w,F as L,a2 as h,c4 as k}from"./index.1921beeb.js";import{Q as y}from"./QPage.a28e4bed.js";import{u as _,Q as x,d as V,t as B,b as C,c as j}from"./module-master.be57f47e.js";import{Q as A,b as O}from"./QItemLabel.ed81b066.js";import{a as G}from"./QSelect.00c3c8b7.js";import{u as W,t as Q,f as U}from"./module-transaksi.a96af80c.js";import{u as F}from"./myglobalstate.9e951e82.js";import{_ as I}from"./ComPopupImgPdfBarcode.65e8a2e9.js";import"./QList.0ff0e2c9.js";import"./QImg.65c43243.js";import"./ComQDialogBig.ace7afb0.js";import"./ComBarcodeGenerator.1bbbf28b.js";const S=p("div",{class:"row q-mb-sm"},[p("div",{class:"col-12 text-right"})],-1),q={class:"row"},z={class:"col-12"},N=p("br",null,null,-1),P=p("br",null,null,-1),R=p("br",null,null,-1),$=p("br",null,null,-1),D={class:"row justify-evenly",style:{width:"200px"}},J={class:"col"},T={class:"col"},E={class:"col"},H={class:"row q-mt-md justify-between"},K=p("div",{class:"q-gutter-xs"},null,-1),M={class:"q-gutter-xs"},X=o({__name:"GudangBarangStokOpnameFormPage",setup(o){F().title="Form Stok Opname";const X=W(),Y=[e=>e&&e.length>0||"Required!"];i("");const Z=t(),ee=i([{name:"remove",label:"",field:"",align:"left",sortable:!1},{name:"barid",label:"Barang",field:"",align:"left",sortable:!0},{name:"file",label:"File",field:"",align:"left",sortable:!0},{name:"offid",label:"Office",field:"offid",align:"left",sortable:!0},{name:"wareid",label:"Warehouse",field:"wareid",align:"left",sortable:!0},{name:"blokid",label:"Blok",field:"blokid",align:"left",sortable:!0},{name:"locid",label:"Location",field:"locid",align:"left",sortable:!0}]),le=i(a(Q));i(a(le.value));const ae=i([]),oe=i(),ie={...a(U),header:a(Q),detail:[],location:a(V),office:a(B),warehouse:a(C),blok:a(j)},te=_(),se=i(a(te.officeList)),de=i(a(te.warehouseList)),ne=i(a(te.blokList)),ue=i(a(te.locationList)),re=i(a(X.dbBarangDetail).flat(1)),fe=async(e,l)=>{if(se.value&&se.value.length>0)return""===e?void l((()=>{se.value=te.officeList})):void l((()=>{const l=e.toLowerCase();se.value=te.officeList.filter((e=>e.offdesc&&e.offdesc.toLowerCase().indexOf(l)>-1))}));await te.getOfficeAll(),l((()=>{se.value=te.officeList}))},ce=async(e,l)=>{if(de.value&&de.value.length>0)return""===e?ie.location.offid&&ie.location.offid.length>0?void l((()=>{var e;const l=null==(e=ie.location.offid)?void 0:e.toLowerCase();de.value=te.warehouseList.filter((e=>e.offid&&e.offid.toLowerCase().indexOf(null!=l?l:"")>-1))})):void l((()=>{de.value=te.warehouseList})):void l((()=>{const l=e.toLowerCase();de.value=te.warehouseList.filter((e=>e.waredesc&&e.waredesc.toLowerCase().indexOf(l)>-1))}));await te.getWarehouseAll(),l((()=>{de.value=te.warehouseList}))},be=async(e,l)=>{if(ne.value&&ne.value.length>0)return""===e?ie.location.wareid&&ie.location.wareid.length>0?void l((()=>{var e;const l=null==(e=ie.location.wareid)?void 0:e.toLowerCase();ne.value=te.blokList.filter((e=>e.wareid&&e.wareid.toLowerCase().indexOf(null!=l?l:"")>-1))})):void l((()=>{ne.value=te.blokList})):void l((()=>{const l=e.toLowerCase();ne.value=te.blokList.filter((e=>e.blokdesc&&e.blokdesc.toLowerCase().indexOf(l)>-1))}));await te.getBlokAll(),l((()=>{console.log(te.blokList,"sini bloklist"),ne.value=te.blokList}))},ve=async(e,l)=>{if(ue.value&&ue.value.length>0)return""===e?ie.location.locid&&ie.location.locid.length>0?void l((()=>{var e;const l=null==(e=ie.location.locid)?void 0:e.toLowerCase();ue.value=te.locationList.filter((e=>e.locid&&e.locid.toLowerCase().indexOf(null!=l?l:"")>-1))})):void l((()=>{ue.value=te.locationList})):void l((()=>{const l=e.toLowerCase();ue.value=te.locationList.filter((e=>e.locdesc&&e.locdesc.toLowerCase().indexOf(l)>-1))}));await te.getLocationAll(),l((()=>{console.log(te.locationList,"sini locationList"),ue.value=te.locationList}))},me=async()=>{await oe.value.validate()&&(0!=ae.value.length?(console.log("ok"),Z.notify({type:"positive",message:"Success Save..!",position:"center",progress:!0})):Z.notify({type:"negative",message:"Silahkan Add Row dahulu..!",position:"center"}))},pe=s((()=>a(ae.value)));d((()=>pe.value),((e,l)=>{e.map(((e,a)=>{var o,i,t,s,d,n;let u=l[a];if(e.wareid&&u&&e.wareid!=u.wareid){let l=de.value.findIndex((l=>`${l.offid}${l.wareid}`==e.wareid));-1!=l&&(ae.value[a].offid=null!=(o=de.value[l].offid)?o:"")}if(e.blokid&&u&&e.blokid!=u.blokid){let l=ne.value.findIndex((l=>`${l.wareid}${l.blokid}`==e.blokid));-1!=l&&(ae.value[a].offid=null!=(i=ne.value[l].offid)?i:"",ae.value[a].wareid=null!=(t=ne.value[l].wareid)?t:"")}if(e.locid&&u&&e.locid!=u.locid){let l=ue.value.findIndex((l=>l.locid==e.locid));console.log(l),-1!=l&&(ae.value[a].offid=null!=(s=ue.value[l].offid)?s:"",ae.value[a].wareid=null!=(d=ue.value[l].wareid)?d:"",ae.value[a].blokid=null!=(n=ue.value[l].blokid)?n:"")}}))}),{deep:!0});return te.getOfficeAll(),te.getWarehouseAll(),te.getBlokAll(),te.getLocationAll(),n((()=>{te.getOfficeAll().then((()=>{se.value=te.officeList})),te.getWarehouseAll().then((()=>{de.value=te.warehouseList})),te.getBlokAll().then((()=>{ne.value=te.blokList})),te.getLocationAll().then((()=>{ue.value=te.locationList}))})),u((()=>{let e={};1==re.value.length&&(e=re.value[0],e.offid="G01",e.wareid="G01W01",e.blokid="G01W01B002",e.locid="12345",ae.value.push(a(e))),2==re.value.length&&(e=re.value[1],e.offid="G01",e.wareid="G01W01",e.blokid="G01W01B002",e.locid="12345",ae.value.push(a(e))),3==re.value.length&&(e=re.value[2],e.offid="G01",e.wareid="G01W01",e.blokid="G01W01B002",e.locid="12345",ae.value.push(a(e)))})),(a,o)=>(r(),f(v(y),{padding:""},{default:c((()=>[b(v(m),{greedy:"",ref_key:"formRef",ref:oe},{default:c((()=>[S,p("div",q,[p("div",z,[b(v(x),{loading:v(Z).loadingBar.isActive,rows:ae.value,columns:ee.value,"rows-per-page-options":[0],ref:"tblRef","table-style":"table-layout: fixed"},{"body-cell-barid":c((({row:l,rowIndex:a})=>[b(v(e),null,{default:c((()=>[b(v(G),{filled:"",modelValue:l.barid,"onUpdate:modelValue":[e=>l.barid=e,e=>(async(e,l,a)=>{console.log(a);let o=re.value.findIndex((e=>e.barid==a.toString()));if(-1==o)return;let i=re.value[o];e.imgbarang=i.imgbarang,e.pdfbarang=i.pdfbarang})(l,0,e)],"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Barang",options:re.value,rules:Y,"option-value":"barid","option-label":"desc","emit-value":"","map-options":"",behavior:"menu",disable:""},{"no-option":c((()=>[b(v(A),null,{default:c((()=>[b(v(O),{class:"text-grey"},{default:c((()=>[g(" No results ")])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","options"]),l.imgbarang||l.pdfbarang?(r(),w(L,{key:0},[g(" Office: G01"),N,g(" Warehouse: G01W01"),P,g(" Blok: G01W01B002"),R,g(" Location: 12345"),$],64)):h("",!0)])),_:2},1024)])),"body-cell-file":c((({row:l})=>[b(v(e),{"auto-width":"",style:{"white-space":"nowrap"}},{default:c((()=>[p("div",D,[p("div",J,[l.imgbarang||l.pdfbarang?(r(),f(I,{isimage:"",row:l,b64:l.imgbarang.base64,key:l.barid},null,8,["row","b64"])):h("",!0)]),p("div",T,[l.imgbarang||l.pdfbarang?(r(),f(I,{isfile:"",row:l,b64:l.pdfbarang.base64,key:l.barid},null,8,["row","b64"])):h("",!0)]),p("div",E,[l.imgbarang||l.pdfbarang?(r(),f(I,{isbarcode:"",row:l,key:l.barid},null,8,["row"])):h("",!0)])])])),_:2},1024)])),"body-cell-wareid":c((({row:l})=>[b(v(e),null,{default:c((()=>[b(v(G),{filled:"",modelValue:l.wareid,"onUpdate:modelValue":e=>l.wareid=e,"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Warehouse",options:de.value,rules:Y,onFilter:ce,"option-value":"wareunqid","option-label":"waredesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":c((()=>[b(v(A),null,{default:c((()=>[b(v(O),{class:"text-grey"},{default:c((()=>[g(" No results ")])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","options"])])),_:2},1024)])),"body-cell-blokid":c((({row:l})=>[b(v(e),null,{default:c((()=>[b(v(G),{filled:"",modelValue:l.blokid,"onUpdate:modelValue":e=>l.blokid=e,"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Blok",options:ne.value,rules:Y,onFilter:be,"option-value":"blokunqid","option-label":"blokdesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":c((()=>[b(v(A),null,{default:c((()=>[b(v(O),{class:"text-grey"},{default:c((()=>[g(" No results ")])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","options"])])),_:2},1024)])),"body-cell-offid":c((({row:l})=>[b(v(e),null,{default:c((()=>[b(v(G),{filled:"",modelValue:l.offid,"onUpdate:modelValue":e=>l.offid=e,"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Office",options:se.value,rules:Y,onFilter:fe,"option-value":"offcode","option-label":"offdesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":c((()=>[b(v(A),null,{default:c((()=>[b(v(O),{class:"text-grey"},{default:c((()=>[g(" No results ")])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","options"])])),_:2},1024)])),"body-cell-locid":c((({row:l})=>[b(v(e),null,{default:c((()=>[b(v(G),{filled:"",modelValue:l.locid,"onUpdate:modelValue":e=>l.locid=e,"use-input":"",dense:"","lazy-rules":"","input-debounce":"0",label:"Location",options:ue.value,rules:Y,onFilter:ve,"option-value":"locid","option-label":"locdesc","emit-value":"","map-options":"",behavior:"menu"},{"no-option":c((()=>[b(v(A),null,{default:c((()=>[b(v(O),{class:"text-grey"},{default:c((()=>[g(" No results ")])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","options"])])),_:2},1024)])),loading:c((()=>[b(l,{showing:"",color:"primary"})])),_:1},8,["loading","rows","columns"])])]),p("div",H,[K,p("div",M,[b(v(k),{color:"primary",label:"Save",onClick:me})])])])),_:1},512)])),_:1}))}});export{X as default};
