import{r as e,c as a,g as t,bK as l,h as i,bN as n,br as s,cg as o,cy as r,ch as u,cj as c,cz as d,cL as m,cA as v,cM as p,ci as f,bJ as h,j as g,ca as b,aA as _,a3 as y,a4 as w,d as x,b2 as C,aa as E,c4 as k,b$ as F,a1 as S,a2 as I,F as D,ap as L,cN as V,cO as j,cP as M,o as z,a8 as P,J as U,c3 as O,P as Q,cQ as N,cK as T}from"./index.1921beeb.js";import{Q as q}from"./QBadge.2b2d9dcd.js";import{Q as A,a as B}from"./QSelect.00c3c8b7.js";import{Q as R,c as W}from"./index.229e2d0a.js";import{Q as $,_ as K}from"./ComQDialogBig.ace7afb0.js";import{Q as H}from"./QImg.65c43243.js";import{t as J}from"./upload-file.01a69925.js";function G(e,a,t,l){const i=[];return e.forEach((e=>{!0===l(e)?i.push(e):a.push({failedPropValidation:t,file:e})})),i}function X(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),n(e)}var Y=s({name:"QFile",inheritAttrs:!1,props:{...o,...r,...{multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...u,"rejected"],setup(s,{slots:o,emit:r,attrs:u}){const{proxy:g}=t(),b=c(),_=e(null),y=e(!1),w=d(s),{pickFiles:x,onDragover:C,onDragleave:E,processFiles:k,getDndNode:F}=function({editable:s,dnd:o,getFileInput:r,addFilesToQueue:u}){const{props:c,emit:d,proxy:m}=t(),v=e(null),p=a((()=>void 0!==c.accept?c.accept.split(",").map((e=>"*"===(e=e.trim())?"*/":(e.endsWith("/*")&&(e=e.slice(0,e.length-1)),e.toUpperCase()))):null)),f=a((()=>parseInt(c.maxFiles,10))),h=a((()=>parseInt(c.maxTotalSize,10)));function g(e){if(s.value)if(e!==Object(e)&&(e={target:null}),null!==e.target&&!0===e.target.matches('input[type="file"]'))0===e.clientX&&0===e.clientY&&l(e);else{const a=r();a&&a!==e.target&&a.click(e)}}function b(e){s.value&&e&&u(null,e)}function _(e){n(e),e.relatedTarget!==v.value&&(o.value=!1)}function y(e){X(e);const a=e.dataTransfer.files;a.length>0&&u(null,a),o.value=!1}return Object.assign(m,{pickFiles:g,addFiles:b}),{pickFiles:g,addFiles:b,onDragover:function(e){X(e),!0!==o.value&&(o.value=!0)},processFiles:function(e,a,t,l){let i=Array.from(a||e.target.files);const n=[],s=()=>{n.length>0&&d("rejected",n)};if(void 0!==c.accept&&-1===p.value.indexOf("*/")&&(i=G(i,n,"accept",(e=>p.value.some((a=>e.type.toUpperCase().startsWith(a)||e.name.toUpperCase().endsWith(a))))),0===i.length))return s();if(void 0!==c.maxFileSize){const e=parseInt(c.maxFileSize,10);if(i=G(i,n,"max-file-size",(a=>a.size<=e)),0===i.length)return s()}if(!0!==c.multiple&&i.length>0&&(i=[i[0]]),i.forEach((e=>{e.__key=e.webkitRelativePath+e.lastModified+e.name+e.size})),!0===l){const e=t.map((e=>e.__key));i=G(i,n,"duplicate",(a=>!1===e.includes(a.__key)))}if(0===i.length)return s();if(void 0!==c.maxTotalSize){let e=!0===l?t.reduce(((e,a)=>e+a.size),0):0;if(i=G(i,n,"max-total-size",(a=>(e+=a.size,e<=h.value))),0===i.length)return s()}if("function"==typeof c.filter){const e=c.filter(i);i=G(i,n,"filter",(a=>e.includes(a)))}if(void 0!==c.maxFiles){let e=!0===l?t.length:0;if(i=G(i,n,"max-files",(()=>(e++,e<=f.value))),0===i.length)return s()}return s(),i.length>0?i:void 0},getDndNode:function(e){if(!0===o.value)return i("div",{ref:v,class:`q-${e}__dnd absolute-full`,onDragenter:X,onDragover:X,onDragleave:_,onDrop:y})},maxFilesNumber:f,maxTotalSizeNumber:h}}({editable:b.editable,dnd:y,getFileInput:T,addFilesToQueue:q}),S=m(s),I=a((()=>Object(s.modelValue)===s.modelValue?"length"in s.modelValue?Array.from(s.modelValue):[s.modelValue]:[])),D=a((()=>v(I.value))),L=a((()=>I.value.map((e=>e.name)).join(", "))),V=a((()=>p(I.value.reduce(((e,a)=>e+a.size),0)))),j=a((()=>({totalSize:V.value,filesNumber:I.value.length,maxFiles:s.maxFiles}))),M=a((()=>({tabindex:-1,type:"file",title:"",accept:s.accept,capture:s.capture,name:w.value,...u,id:b.targetUid.value,disabled:!0!==b.editable.value}))),z=a((()=>"q-file q-field--auto-height"+(!0===y.value?" q-file--dnd":""))),P=a((()=>!0===s.multiple&&!0===s.append));function U(e){const a=I.value.slice();a.splice(e,1),O(a)}function O(e){r("update:modelValue",!0===s.multiple?e:e[0])}function Q(e){13===e.keyCode&&h(e)}function N(e){13!==e.keyCode&&32!==e.keyCode||x(e)}function T(){return _.value}function q(e,a){const t=k(e,a,I.value,P.value),l=T();null!=l&&(l.value=""),void 0!==t&&((!0===s.multiple?s.modelValue&&t.every((e=>I.value.includes(e))):s.modelValue===t[0])||O(!0===P.value?I.value.concat(t):t))}function B(){return[i("input",{class:[s.inputClass,"q-file__filler"],style:s.inputStyle})]}function R(){const e={ref:_,...M.value,...S.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:q};return!0===s.multiple&&(e.multiple=!0),i("input",e)}return Object.assign(b,{fieldClass:z,emitValue:O,hasValue:D,inputRef:_,innerValue:I,floatingLabel:a((()=>!0===D.value||v(s.displayValue))),computedCounter:a((()=>{if(void 0!==s.counterLabel)return s.counterLabel(j.value);const e=s.maxFiles;return`${I.value.length}${void 0!==e?" / "+e:""} (${V.value})`})),getControlChild:()=>F("file"),getControl:()=>{const e={ref:b.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:s.tabindex};return!0===b.editable.value&&Object.assign(e,{onDragover:C,onDragleave:E,onKeydown:Q,onKeyup:N}),i("div",e,[R()].concat(function(){if(void 0!==o.file)return 0===I.value.length?B():I.value.map(((e,a)=>o.file({index:a,file:e,ref:this})));if(void 0!==o.selected)return 0===I.value.length?B():o.selected({files:I.value,ref:this});if(!0===s.useChips)return 0===I.value.length?B():I.value.map(((e,a)=>i(A,{key:"file-"+a,removable:b.editable.value,dense:!0,textColor:s.color,tabindex:s.tabindex,onRemove:()=>{U(a)}},(()=>i("span",{class:"ellipsis",textContent:e.name})))));const e=void 0!==s.displayValue?s.displayValue:L.value;return e.length>0?[i("div",{class:s.inputClass,style:s.inputStyle,textContent:e})]:B()}()))}}),Object.assign(g,{removeAtIndex:U,removeFile:function(e){const a=I.value.findIndex(e);a>-1&&U(a)},getNativeElement:()=>_.value}),f(b)}});class Z{constructor(e,a="user",t=null,l=null){this._webcamElement=e,this._webcamElement.width=this._webcamElement.width||640,this._webcamElement.height=this._webcamElement.height||this._webcamElement.width*(3/4),this._facingMode=a,this._webcamList=[],this._streamList=[],this._selectedDeviceId="",this._canvasElement=t,this._snapSoundElement=l}get facingMode(){return this._facingMode}set facingMode(e){this._facingMode=e}get webcamList(){return this._webcamList}get webcamCount(){return this._webcamList.length}get selectedDeviceId(){return this._selectedDeviceId}getVideoInputs(e){return this._webcamList=[],e.forEach((e=>{"videoinput"===e.kind&&this._webcamList.push(e)})),1==this._webcamList.length&&(this._facingMode="user"),this._webcamList}getMediaConstraints(){var e={};return""==this._selectedDeviceId?e.facingMode=this._facingMode:e.deviceId={exact:this._selectedDeviceId},{video:e,audio:!1}}selectCamera(){for(let e of this._webcamList)if("user"==this._facingMode&&e.label.toLowerCase().includes("front")||"enviroment"==this._facingMode&&e.label.toLowerCase().includes("back")){this._selectedDeviceId=e.deviceId;break}}flip(){this._facingMode="user"==this._facingMode?"enviroment":"user",this._webcamElement.style.transform="",this.selectCamera()}async start(e=!0){return new Promise(((a,t)=>{this.stop(),navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then((l=>{this._streamList.push(l),this.info().then((l=>{this.selectCamera(),e?this.stream().then((e=>{a(this._facingMode)})).catch((e=>{t(e)})):a(this._selectedDeviceId)})).catch((e=>{t(e)}))})).catch((e=>{t(e)}))}))}async info(){return new Promise(((e,a)=>{navigator.mediaDevices.enumerateDevices().then((a=>{this.getVideoInputs(a),e(this._webcamList)})).catch((e=>{a(e)}))}))}async stream(){return new Promise(((e,a)=>{navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then((a=>{this._streamList.push(a),this._webcamElement.srcObject=a,"user"==this._facingMode&&(this._webcamElement.style.transform="scale(-1,1)"),this._webcamElement.play(),e(this._facingMode)})).catch((e=>{console.log(e),a(e)}))}))}stop(){this._streamList.forEach((e=>{e.getTracks().forEach((e=>{e.stop()}))}))}snap(){if(null!=this._canvasElement){null!=this._snapSoundElement&&this._snapSoundElement.play(),this._canvasElement.height=this._webcamElement.scrollHeight,this._canvasElement.width=this._webcamElement.scrollWidth;let e=this._canvasElement.getContext("2d");return"user"==this._facingMode&&(e.translate(this._canvasElement.width,0),e.scale(-1,1)),e.clearRect(0,0,this._canvasElement.width,this._canvasElement.height),e.drawImage(this._webcamElement,0,0,this._canvasElement.width,this._canvasElement.height),this._canvasElement.toDataURL("image/png")}throw"canvas element is missing"}}const ee={class:"row"},ae={class:"col"},te={class:"row q-mb-md"},le={class:"col-3"},ie={class:"q-ml-md col-3 q-gutter-xs"},ne={class:"row"},se={class:"col-6"},oe={class:"col-6"},re=g({__name:"ComWebcam",emits:["update:model-value"],setup(a,{emit:t}){const l=b(),i=e(null),n=e(null),s=e(null),o=e([]),r=e(null),u=e([]);let c=null;const d=async()=>{g.value=!0,await L(),c=new Z(i.value,"enviroment",n.value,null),await c.start(!1),u.value=c._webcamList,r.value=c._webcamList[0].label,c._selectedDeviceId=c._webcamList[0].deviceId,c.stream()},m=()=>{c.stop()},v=()=>{c.stream()},p=()=>{null!=r.value&&(c._selectedDeviceId=r.value.deviceId,c.stop(),c.stream())},f=async()=>{var e=c.snap();s.value=e,await L();const a=await V(s.value);o.value.push(a.url),await L()},h=async()=>{try{const e=await V(s.value),a=await j(e.blob,M().replaceAll("-",""));t("update:model-value",a),await L(),z()}catch(e){console.log(e),l.notify({type:"negative",message:"Upss.. Take Picture First.!!",position:"center"})}},g=e(!1),z=async()=>{m(),await L(),g.value=!1};return(e,a)=>(_(),y(D,null,[w("div",ee,[w("div",ae,[x(k,{color:"secondary",icon:"add_a_photo",dense:"",round:"",onClick:d},{default:C((()=>[x($,null,{default:C((()=>[E(" Camera ")])),_:1})])),_:1})])]),x(K,{onHide:z,"show-dialog":g.value,"custom-fn-save":h,"label-save":"Ok"},{default:C((()=>[w("div",te,[w("div",le,[x(B,{standout:"",modelValue:r.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>r.value=e),p],options:u.value,"option-value":"deviceId","option-label":"label",dense:"","options-dense":""},{append:C((()=>[x(F,{name:"camera"})])),_:1},8,["modelValue","options"])]),w("div",ie,[x(k,{onClick:v,color:"positive",dense:""},{default:C((()=>[E("Start")])),_:1}),x(k,{onClick:m,color:"negative",dense:""},{default:C((()=>[E("Stop")])),_:1}),x(k,{onClick:f,color:"primary",dense:""},{default:C((()=>[E("Take Picture")])),_:1})])]),w("div",ne,[w("div",se,[w("video",{id:"webcam",autoplay:"",playsinline:"",ref_key:"webcam",ref:i,width:"640",height:"380"},null,512)]),w("div",oe,[w("canvas",{id:"canvas",ref_key:"canvasImg",ref:n,class:"d-none",height:"380",width:"280",style:{display:"none"}},null,512),null!=s.value?(_(),S(H,{key:0,src:s.value,loading:"lazy","spinner-color":"white",style:{"max-width":"490px"}},null,8,["src"])):I("",!0)])])])),_:1},8,["show-dialog"])],64))}}),ue={class:"ellipsis relative-position"},ce=["src"],de=g({__name:"ComQFile",props:{isUploading:{type:Boolean,default:!1},isPending:{type:Boolean,default:!1},isFinish:{type:Boolean,default:!1},isShow:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},rules:{type:[],default:[]},val:{type:File,default:void 0},b64:{type:String,default:""},label:{type:String,default:"Pilih file"},accept:{type:String,default:"application/pdf,image/png, image/jpeg, image/jpg"},isImage:{type:Boolean,default:!1}},emits:["update:model-value"],setup(t,{emit:l}){const i=t,n=b(),s=e();e(null);const o=a((()=>i.isShow)),r=e(),u=e(),c=e(!1),d=e(""),m=async e=>{var a,t,i,n;let o=W(J),u=await N(e),c=null!=(a=await T(null==u?void 0:u.blob))?a:"";o.blob=null!=(t=null==u?void 0:u.blob)?t:null,o.bloburl=null!=(i=null==u?void 0:u.url)?i:"",o.file=null!=e?e:null,o.nama=null!=(n=null==e?void 0:e.name)?n:"",o.base64=null==c?void 0:c.toString(),l("update:model-value",o),r.value=e,null!=e&&(s.value={error:!1,color:"green-2",percent:0,icon:0===e.type.indexOf("video/")?"movie":0===e.type.indexOf("image/")?"photo":0===e.type.indexOf("audio/")?"audiotrack":"insert_drive_file"})},v=async()=>{var e;if(!r.value)return;const a=await N(r.value);d.value=null!=(e=null==a?void 0:a.url)?e:"",c.value=!0},p=async()=>{c.value=!1};return z((async()=>{if(i.val||i.b64){const e=await V(i.b64),a=await j(null==e?void 0:e.blob,M().replaceAll("-",""));a&&u.value.addFiles([a])}})),(e,a)=>(_(),y(D,null,[x(U(Y),{rules:i.rules,"lazy-rules":"","model-value":r.value,"onUpdate:modelValue":m,label:t.label,filled:"",dense:"",clearable:!i.isFinish&&!i.isUploading&&!i.isPending,disable:i.isPending,loading:i.isUploading,ref_key:"fileRef",ref:u,accept:t.accept},P({file:C((({file:e})=>[x(U(A),{class:"full-width q-my-xs",dense:"",square:""},{default:C((()=>[x(U(R),{class:"absolute-full full-height","track-color":"grey-2"}),x(U(O),null,{default:C((()=>{var e;return[x(U(F),{name:null!=(e=s.value.icon)?e:""},null,8,["name"])]})),_:1}),w("div",ue,Q(e.name),1),x(U($),null,{default:C((()=>[E(Q(e.name),1)])),_:2},1024)])),_:2},1024)])),after:C((()=>[r.value||U(o)?(_(),S(U(k),{key:0,color:i.isPending?"warning":"primary",dense:"",round:"",icon:i.isPending?"pending":"open_in_new",onClick:v,loading:i.isUploading},{default:C((()=>[x(U($),null,{default:C((()=>[E(Q(i.isPending?"Pending":"Show"),1)])),_:1})])),_:1},8,["color","icon","loading"])):I("",!0),i.isError?(_(),S(U(q),{key:1,color:"negative",dense:"",round:"",icon:"close"},{default:C((()=>[E("Gagal Uplaod")])),_:1})):I("",!0),i.isFinish?(_(),S(U(q),{key:2,color:"positive",dense:"",round:"",icon:"done"},{default:C((()=>[E("Success")])),_:1})):I("",!0)])),_:2},[U(n).platform.is.desktop&&t.isImage&&!U(o)?{name:"before",fn:C((()=>[x(re,{"onUpdate:modelValue":m})])),key:"0"}:void 0]),1032,["rules","model-value","label","clearable","disable","loading","accept"]),x(K,{onHide:p,"show-dialog":c.value},{default:C((()=>[w("iframe",{width:"100%",height:"100%",frameborder:"0",src:d.value,id:"frame"},null,8,ce)])),_:1},8,["show-dialog"])],64))}});export{de as _};
